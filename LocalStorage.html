<!DOCTYPE html>
<html>
<head>
    <title>CRUD | Book Inventory</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
</head>
<body>
    <div class="container">
        <h1 class="mt-5 mb-5">Book Inventory</h1>
        <table class="table table-bordered" id="crudTable">
            <thead>
                <tr>
                    <th>bookId</th>
                    <th>Title</th>
                    <th>Author</th>
                    <th>Description</th>
                    <th>Count</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="tblbody">
            </tbody>
        </table>
        </fieldset>
    </div>
</body>
</html>
<script type="text/javascript">


    bindBookData();
    function addBookData(bookObj) {


        //already has data in localstorage then update it other create new one
        let books = JSON.parse(localStorage.getItem('bookData'));
        if (books != null) {
            books.push(bookObj);
           
            localStorage.setItem('bookData', JSON.stringify(books));
        }
        else {
            let bookData = new Array();
            bookData.push(bookObj);
            localStorage.setItem('bookData', JSON.stringify(bookData));


        }
    }


    function updateBookData(bookObj) {


        let books = JSON.parse(localStorage.getItem('bookData'));
        if (books != null) {
            var book = books.filter((x) => x.id == bookObj.id).pop();
            if (book != null) {
                book.title = bookObj.title;
                book.author = bookObj.author;
                book.desc = bookObj.desc;
                book.count = bookObj.count;
            }
            localStorage.setItem('bookData', JSON.stringify(books));
        }
    }


    function deleteBookData(bookId) {


        let books = JSON.parse(localStorage.getItem('bookData'));
        if (books != null) {
            books.splice(books.findIndex(a => a.id === bookId), 1)
            localStorage.setItem('bookData', JSON.stringify(books));
        }
    }




    function bindBookData() {
        let books = JSON.parse(localStorage.getItem('bookData'));
        if (books != null) {
            document.getElementById('tblbody').innerHTML = "";
            books.forEach(function (item, index) {
                // debugger;
                let btnEditId = "btnedit" + item.id;
                let btnDeleteId = "btndelete" + item.id;
                let tableRow = "<tr Id='" + item.id + "'   data-CustomerID='" + item.id + "'   book-title='" + item.title + "' book-author='" + item.author + "' book-desc='" + item.desc + "' book-count='" + item.count + "'>"
                    + "<td class='td-data'>" + item.id + "</td>"
                    + "<td class='td-data'>" + item.title + "</td>"
                    + "<td class='td-data'>" + item.author + "</td>"
                    + "<td class='td-data'>" + item.desc + "</td>"
                    + "<td class='td-data'>" + item.count + "</td>"
                    + "<td class='td-data'>" +
                    "<button id='" + btnEditId + "' class='btn btn-info btn-xs btn-editcustomer' onclick='showEditRow(" + item.id + ")'><i class='fa fa-pencil' aria-hidden='true'></i>Edit</button>" +
                    "<button id='" + btnDeleteId + "' class='btn btn-danger btn-xs btn-deleteCustomer' onclick='deleteRow(" + item.id + ")'><i class='fa fa-trash' aria-hidden='true'>Delete</button>"
                    + "</td>"
                    + "</tr>";
                document.getElementById('tblbody').innerHTML += tableRow;
            })
        }
        var AddRow = "<tr>"
            + "<td class='td-data'></td>"
            + "<td class='td-data'><input type='text' id='title' placeholder='Book Title'></td>"
            + "<td class='td-data'><input type='text' id='author' placeholder='Author Name'></td>"
            + "<td class='td-data'><input type='text' id='desc' placeholder='Book Description'></td>"
            + "<td class='td-data'><input type='text' id='count' placeholder='Book Count'></td>"
            + "<td class='td-data'>" + "<button id= 'btnaddCustomer' onclick='addBook()' class='btn btn-success'> <i class='fa fa-plus-circle' aria-hidden='true'></i>Add</button>" + "</td>"
            + "</tr>";
        document.getElementById('tblbody').innerHTML += AddRow;
    }


    function GetBookID() {
        const ID = Date.now();
        return ID;
    }


    function addBook() {
        var bookId = GetBookID();
        var title = document.getElementById("title").value;
        if (!title) {
            alert('Please enter book title!')
            return false;
        }
        var author = document.getElementById("author").value;
        if (!author) {
            alert('Please enter author name!')
            return false;
        }
        var desc = document.getElementById("desc").value;
        if (!desc) {
            alert('Please enter book description!')
            return false;
        }
        var count = document.getElementById("count").value;
        if (!count) {
            alert('Please enter book count!')
            return false;
        }
        var bookObj = {
            "id": bookId,
            "title": title,
            "author": author,
            "desc": desc,
            "count": count,
        };
        addBookData(bookObj)
        document.getElementById('title').value = "";
        document.getElementById('author').value = "";
        document.getElementById('desc').value = "";
        document.getElementById('count').value = "";
        bindBookData();
    };


    function showEditRow(bookId) {
        let bookRow = document.getElementById(bookId); //this gives tr of  whose button was clicked
        let trdata = bookRow.querySelectorAll(".td-data");
        /*returns array of all elements with
        "row-data" class within the row with given id*/
        let bookID = trdata[0].innerHTML;
        let title = trdata[1].innerHTML;
        let author = trdata[2].innerHTML;
        let desc = trdata[3].innerHTML;
        let count = trdata[4].innerHTML;


        trdata[0].innerHTML = '<input name="bookId"  disabled id="bookId" value="' + bookId + '"/>';
        trdata[1].innerHTML = '<input name="title" id="title" value="' + title + '"/>';
        trdata[2].innerHTML = '<input name="author" id="author" value="' + author + '"/>';
        trdata[3].innerHTML = '<input name="desc" id="desc" value="' + desc + '"/>';
        trdata[4].innerHTML = '<input name="count" id="count" value="' + count + '"/>';


        trdata[5].innerHTML =
            "<button class='btn btn-primary btn-xs btn-updateBook' onclick='updateBook(" + bookId + ")'>" +
            "<i class='fa fa-pencil' aria-hidden='true'></i>Save</button>"
            + "<button class='btn btn-warning btn-xs btn-cancelupdate' onclick='cancel(" + bookId + ")'><i class='fa fa-times' aria-hidden='true'></i>Cancel</button>"
            
    }
    function cancel(bookId) {
        debugger;
        let btneditId = "btnedit" + bookId;
        let btndeleteId = "btndelete" + bookId;


        let CustomerRow = document.getElementById(bookId); //this gives tr of  whose button was clicked
        let data = CustomerRow.querySelectorAll(".td-data");


        let title = CustomerRow.getAttribute("book-title");
        let author = CustomerRow.getAttribute("book-author");
        let desc = CustomerRow.getAttribute("book-desc");
        let count = CustomerRow.getAttribute("book-count");


        data[0].innerHTML = bookId;
        data[1].innerHTML = title;
        data[2].innerHTML = author;
        data[3].innerHTML = desc;
        data[4].innerHTML = count;
        let actionbtn = "<button id='" + btneditId + "' class='btn btn-info btn-xs btn-editbook' onclick='showEditRow(" + bookId + ")'><i class='fa fa-pencil' aria-hidden='true'></i>Edit</button>" +
            "<button id='" + btndeleteId + "' class='btn btn-danger btn-xs btn-deleteBook' onclick='deleteRow(" + bookId + ")'><i class='fa fa-trash' aria-hidden='true'>Delete</button>"
        data[5].innerHTML = actionbtn;
    }
    function updateBook(bookId) {
        let userRow = document.getElementById(bookId); //this gives tr of  whose button was clicked
        let data = userRow.querySelectorAll(".td-data");
        let title = data[1].querySelector("#title").value;
        let author = data[2].querySelector("#author").value;
        let desc = data[3].querySelector("#desc").value;
        let count = data[4].querySelector("#count").value;
        let bookObj = {
            "id": bookId,
            "title": title,
            "author": author,
            "desc": desc,
            "count": count
        };
        updateBookData(bookObj);
        bindBookData();
    }
    function deleteRow(bookId) {
        deleteBookData(bookId);
        bindBookData();
    }
</script>
